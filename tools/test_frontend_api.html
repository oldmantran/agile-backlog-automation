<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>API Test Page</h1>
    <button onclick="testBasicAPI()">Test Basic API</button>
    <button onclick="testProjectCreation()">Test Project Creation</button>
    <button onclick="testBacklogGeneration()">Test Backlog Generation</button>
    <div id="results"></div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += `<div>${new Date().toISOString()}: ${message}</div>`;
            console.log(message);
        }

        async function testBasicAPI() {
            log('üß™ Testing basic API connectivity...');
            try {
                const response = await axios.get(`${API_BASE_URL}/test`, { timeout: 10000 });
                log(`‚úÖ Test endpoint response: ${response.status}`);
                log(`üìÑ Response: ${JSON.stringify(response.data)}`);
            } catch (error) {
                log(`‚ùå Test endpoint failed: ${error.message}`);
                if (error.response) {
                    log(`‚ùå Response status: ${error.response.status}`);
                    log(`‚ùå Response data: ${JSON.stringify(error.response.data)}`);
                }
            }
        }

        async function testProjectCreation() {
            log('üìù Testing project creation...');
            const projectData = {
                basics: {
                    name: "Test Project",
                    description: "Test project for API testing",
                    domain: "testing"
                },
                vision: {
                    visionStatement: "A test project to verify API functionality",
                    businessObjectives: ["Test API", "Verify connectivity"],
                    successMetrics: ["API responds", "No timeouts"],
                    targetAudience: "developers"
                },
                azureConfig: {
                    organizationUrl: "https://dev.azure.com/test",
                    personalAccessToken: "",
                    project: "TestProject",
                    areaPath: "Test",
                    iterationPath: "Sprint 1"
                }
            };

            try {
                const response = await axios.post(`${API_BASE_URL}/projects`, projectData, { 
                    timeout: 30000,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                log(`‚úÖ Project creation response: ${response.status}`);
                log(`üìÑ Response: ${JSON.stringify(response.data)}`);
                
                if (response.data.projectId) {
                    window.testProjectId = response.data.projectId;
                    log(`üÜî Created project ID: ${window.testProjectId}`);
                }
            } catch (error) {
                log(`‚ùå Project creation failed: ${error.message}`);
                if (error.response) {
                    log(`‚ùå Response status: ${error.response.status}`);
                    log(`‚ùå Response data: ${JSON.stringify(error.response.data)}`);
                }
            }
        }

        async function testBacklogGeneration() {
            if (!window.testProjectId) {
                log('‚ùå No project ID available. Please create a project first.');
                return;
            }

            log(`üöÄ Testing backlog generation for project: ${window.testProjectId}`);
            log(`‚è∞ Start time: ${new Date().toISOString()}`);
            
            try {
                const response = await axios.post(`${API_BASE_URL}/backlog/generate/${window.testProjectId}`, {}, {
                    timeout: 60000,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                log(`‚è∞ End time: ${new Date().toISOString()}`);
                log(`‚úÖ Backlog generation response: ${response.status}`);
                log(`üìÑ Response: ${JSON.stringify(response.data)}`);
                
                if (response.status === 200) {
                    log('üéâ SUCCESS: Backlog generation API call completed successfully!');
                } else {
                    log(`‚ùå FAILED: Unexpected status code: ${response.status}`);
                }
            } catch (error) {
                log(`‚è∞ End time: ${new Date().toISOString()}`);
                log(`‚ùå Backlog generation failed: ${error.message}`);
                
                if (error.code === 'ECONNABORTED') {
                    log('‚ùå TIMEOUT: Request timed out');
                }
                
                if (error.response) {
                    log(`‚ùå Response status: ${error.response.status}`);
                    log(`‚ùå Response data: ${JSON.stringify(error.response.data)}`);
                }
            }
        }
    </script>
</body>
</html> 