<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Issue Diagnosis</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Frontend Issue Diagnosis</h1>
    <div id="results"></div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += `<div>${new Date().toISOString()}: ${message}</div>`;
            console.log(message);
        }

        async function diagnoseIssue() {
            log('üîç Starting frontend issue diagnosis...');
            
            // Test 1: Basic connectivity
            log('üß™ Test 1: Basic connectivity to backend');
            try {
                const response = await fetch('http://localhost:8000/api/test');
                log(`‚úÖ Basic fetch successful: ${response.status}`);
                const data = await response.json();
                log(`üìÑ Response: ${JSON.stringify(data)}`);
            } catch (error) {
                log(`‚ùå Basic fetch failed: ${error.message}`);
                return;
            }

            // Test 2: Axios basic connectivity
            log('üß™ Test 2: Axios basic connectivity');
            try {
                const response = await axios.get('http://localhost:8000/api/test', { timeout: 10000 });
                log(`‚úÖ Axios basic successful: ${response.status}`);
                log(`üìÑ Response: ${JSON.stringify(response.data)}`);
            } catch (error) {
                log(`‚ùå Axios basic failed: ${error.message}`);
                if (error.code === 'ECONNABORTED') {
                    log('‚ùå TIMEOUT detected');
                }
                return;
            }

            // Test 3: Create a project (like the frontend does)
            log('üß™ Test 3: Project creation');
            const projectData = {
                basics: {
                    name: "Diagnostic Test Project",
                    description: "Test project for diagnosis",
                    domain: "testing"
                },
                vision: {
                    visionStatement: "A test project for diagnosis",
                    businessObjectives: ["Test API"],
                    successMetrics: ["API works"],
                    targetAudience: "developers"
                },
                azureConfig: {
                    organizationUrl: "https://dev.azure.com/test",
                    personalAccessToken: "",
                    project: "TestProject",
                    areaPath: "Test",
                    iterationPath: "Sprint 1"
                }
            };

            try {
                const response = await axios.post('http://localhost:8000/api/projects', projectData, {
                    timeout: 30000,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                log(`‚úÖ Project creation successful: ${response.status}`);
                log(`üìÑ Response: ${JSON.stringify(response.data)}`);
                
                const projectId = response.data.projectId;
                log(`üÜî Project ID: ${projectId}`);

                // Test 4: Backlog generation (the failing call)
                log('üß™ Test 4: Backlog generation (the failing call)');
                log(`‚è∞ Start time: ${new Date().toISOString()}`);
                
                try {
                    const backlogResponse = await axios.post(`http://localhost:8000/api/backlog/generate/${projectId}`, {}, {
                        timeout: 60000,
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    log(`‚è∞ End time: ${new Date().toISOString()}`);
                    log(`‚úÖ Backlog generation successful: ${backlogResponse.status}`);
                    log(`üìÑ Response: ${JSON.stringify(backlogResponse.data)}`);
                    log('üéâ SUCCESS: The exact API call that was failing now works!');
                } catch (error) {
                    log(`‚è∞ End time: ${new Date().toISOString()}`);
                    log(`‚ùå Backlog generation failed: ${error.message}`);
                    log(`‚ùå Error code: ${error.code}`);
                    log(`‚ùå Error config: ${JSON.stringify(error.config)}`);
                    
                    if (error.response) {
                        log(`‚ùå Response status: ${error.response.status}`);
                        log(`‚ùå Response data: ${JSON.stringify(error.response.data)}`);
                    }
                    
                    if (error.request) {
                        log(`‚ùå No response received`);
                    }
                }

            } catch (error) {
                log(`‚ùå Project creation failed: ${error.message}`);
                if (error.response) {
                    log(`‚ùå Response status: ${error.response.status}`);
                    log(`‚ùå Response data: ${JSON.stringify(error.response.data)}`);
                }
            }
        }

        // Run diagnosis when page loads
        window.onload = function() {
            log('üöÄ Page loaded, starting diagnosis...');
            diagnoseIssue();
        };
    </script>
</body>
</html> 